<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Embeddings Service</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid #667eea;
        }
        
        .card h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .endpoints {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .endpoint {
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: white;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        
        .method {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        
        .get { background: #28a745; color: white; }
        .post { background: #007bff; color: white; }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-online { background: #28a745; }
        .status-loading { background: #ffc107; }
        
        .footer {
            text-align: center;
            color: white;
            opacity: 0.8;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .main-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Embeddings + Vector Database Service</h1>
            <p>Unified REST microservice for text embeddings and vector storage with LanceDB</p>
            <div style="margin-top: 1rem;">
                <span class="status-indicator status-loading" id="status"></span>
                <span id="status-text">Checking service status...</span>
            </div>
        </div>
        
        <div class="main-content">
            <h2>üöÄ About This Service</h2>
            <p>
                This unified microservice provides two powerful capabilities: generating high-quality text embeddings 
                using Sentence Transformers and storing/searching vectors in a scalable LanceDB database. 
                Perfect for semantic search, RAG systems, recommendation engines, and ML pipelines.
            </p>
            
            <div class="grid">
                <div class="card">
                    <h3>üéØ Features</h3>
                    <ul>
                        <li>High-quality text embeddings</li>
                        <li>Vector database with LanceDB</li>
                        <li>Semantic search capabilities</li>
                        <li>Multi-tenant project isolation</li>
                        <li>Automatic sharding for scale</li>
                        <li>REST and gRPC interfaces</li>
                        <li>Production-ready architecture</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>üîß Tech Stack</h3>
                    <ul>
                        <li>Python 3.8+</li>
                        <li>FastAPI for REST API</li>
                        <li>gRPC for high-performance calls</li>
                        <li>Sentence Transformers</li>
                        <li>LanceDB vector database</li>
                        <li>PyTorch backend</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>üìä Current Model</h3>
                    <ul>
                        <li><strong>Model:</strong> <code id="model-id">Loading...</code></li>
                        <li><strong>Device:</strong> <code id="device">Loading...</code></li>
                        <li><strong>Dimensions:</strong> <code id="dimensions">Loading...</code></li>
                        <li><strong>Batch Size:</strong> <code id="batch-size">Loading...</code></li>
                    </ul>
                </div>
            </div>
            
            <h2>üåê API Endpoints</h2>
            
            <h3 style="margin-top: 1.5rem; color: #667eea;">üìù Embeddings Service</h3>
            <div class="endpoints">
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <strong>/</strong> - This documentation page
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <strong>/health</strong> - Service health check and model information
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <strong>/embed</strong> - Generate embeddings for text(s) üîê
                </div>
            </div>
            
            <h3 style="margin-top: 1.5rem; color: #667eea;">üóÑÔ∏è Vector Database Service</h3>
            <div class="endpoints">
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <strong>/vdb/projects</strong> - Create a new project üîê
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <strong>/vdb/projects</strong> - List all projects üîê
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <strong>/vdb/projects/{project_id}/collections</strong> - Create a collection üîê
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <strong>/vdb/projects/{project_id}/collections</strong> - List collections üîê
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <strong>/vdb/vectors</strong> - Add vector to collection üîê
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <strong>/vdb/search</strong> - Search similar vectors üîê
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <strong>/vdb/vectors/delete</strong> - Delete vector by ID üîê
                </div>
            </div>
            
            <h3 style="margin-top: 1.5rem; color: #667eea;">üìö Documentation</h3>
            <div class="endpoints">
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <strong>/docs</strong> - Interactive API documentation (Swagger UI)
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <strong>/redoc</strong> - Alternative API documentation (ReDoc)
                </div>
            </div>
            
            <h2>üí° Usage Examples</h2>
            
            <div class="card" style="margin-bottom: 1.5rem; background: #fff3cd; border-left: 4px solid #856404;">
                <h3 style="color: #856404;">üîê Authentication Required</h3>
                <p>All endpoints (except <code>/</code>, <code>/health</code>, <code>/docs</code>) require Bearer token authentication.</p>
                <p><strong>Available accounts:</strong> admin, user1, app1, monitoring</p>
            </div>
            
            <h3>üß† Embeddings Service Examples</h3>
            
            <h4 style="margin-top: 1rem;">Single Text Embedding</h4>
            <div class="code-block">
curl -X POST "{{ base_url }}/embed" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-admin-abc123xyz789" \
  -d '{
    "text": "Artificial intelligence is transforming the world",
    "task_type": "passage",
    "normalize": true
  }'
            </div>
            
            <h3>Batch Text Embeddings (Authenticated)</h3>
            <div class="code-block">
curl -X POST "{{ base_url }}/embed" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-user1-def456uvw012" \
  -d '{
    "texts": [
      "Machine learning enables intelligent systems",
      "Deep learning powers modern AI applications"
    ],
    "task_type": "passage",
    "normalize": true
  }'
            </div>
            
            <h3 style="margin-top: 2rem;">üóÑÔ∏è Vector Database Service Examples</h3>
            
            <h4 style="margin-top: 1rem;">1. Create a Project</h4>
            <div class="code-block">
curl -X POST "{{ base_url }}/vdb/projects" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-admin-abc123xyz789" \
  -d '{
    "project_id": "my-rag-app"
  }'
            </div>
            
            <h4 style="margin-top: 1rem;">2. Create a Collection</h4>
            <div class="code-block">
curl -X POST "{{ base_url }}/vdb/projects/my-rag-app/collections" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-admin-abc123xyz789" \
  -d '{
    "collection_name": "documents",
    "dimension": 768,
    "distance_metric": "cosine"
  }'
            </div>
            
            <h4 style="margin-top: 1rem;">3. Add Vectors</h4>
            <div class="code-block">
curl -X POST "{{ base_url }}/vdb/vectors" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-admin-abc123xyz789" \
  -d '{
    "project_id": "my-rag-app",
    "collection_name": "documents",
    "vector_id": "doc-1",
    "vector": [0.1, 0.2, 0.3, ...],
    "metadata": {"title": "AI Overview", "page": 1}
  }'
            </div>
            
            <h4 style="margin-top: 1rem;">4. Search Vectors</h4>
            <div class="code-block">
curl -X POST "{{ base_url }}/vdb/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-admin-abc123xyz789" \
  -d '{
    "project_id": "my-rag-app",
    "collection_name": "documents",
    "query_vector": [0.1, 0.2, 0.3, ...],
    "top_k": 5
  }'
            </div>
            
            <h4 style="margin-top: 1rem;">5. Complete RAG Workflow (Generate + Store + Search)</h4>
            <div class="code-block">
# 1. Generate embedding
EMBEDDING=$(curl -X POST "{{ base_url }}/embed" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-admin-abc123xyz789" \
  -d '{"text": "What is AI?"}' | jq -r '.embedding')

# 2. Store in VDB
curl -X POST "{{ base_url }}/vdb/vectors" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-admin-abc123xyz789" \
  -d "{
    \"project_id\": \"my-rag-app\",
    \"collection_name\": \"documents\",
    \"vector_id\": \"query-1\",
    \"vector\": $EMBEDDING
  }"

# 3. Search similar vectors
curl -X POST "{{ base_url }}/vdb/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-admin-abc123xyz789" \
  -d "{
    \"project_id\": \"my-rag-app\",
    \"collection_name\": \"documents\",
    \"query_vector\": $EMBEDDING,
    \"top_k\": 3
  }"
            </div>
            
            <h3>Health Check (Public)</h3>
            <div class="code-block">
curl -X GET "{{ base_url }}/health"
            </div>
            
            <h3>Example Response with Authentication</h3>
            <div class="code-block">
# Embeddings response
{
  "model_id": "BAAI/bge-base-en-v1.5",
  "dim": 768,
  "embedding": [0.1234, -0.5678, ...],
  "requested_by": "admin"
}

# VDB search response
{
  "results": [
    {
      "vector_id": "doc-1",
      "score": 0.95,
      "metadata": {"title": "AI Overview", "page": 1}
    },
    {
      "vector_id": "doc-3",
      "score": 0.87,
      "metadata": {"title": "ML Basics", "page": 5}
    }
  ]
}
            </div>
            
            <div class="card" style="margin-top: 2rem; background: #d1ecf1; border-left: 4px solid #0c5460;">
                <h3 style="color: #0c5460;">üí° VDB Service Features</h3>
                <ul>
                    <li><strong>Multi-tenant:</strong> Isolate data per project</li>
                    <li><strong>Auto-sharding:</strong> Automatically distributes vectors across shards</li>
                    <li><strong>Distance metrics:</strong> Cosine, L2, and Dot Product</li>
                    <li><strong>Metadata:</strong> Store arbitrary JSON metadata with vectors</li>
                    <li><strong>Persistence:</strong> Data persists across restarts</li>
                    <li><strong>Scalable:</strong> LanceDB handles billions of vectors</li>
                </ul>
            </div>
        </div>
        
        <div class="footer">
            <p>
                üîó <a href="/docs" style="color: white;">Interactive API Docs</a> | 
                üìã <a href="/health" style="color: white;">Health Check</a> |
                üóÑÔ∏è Vector Database with LanceDB |
                üß† Powered by Sentence Transformers
            </p>
        </div>
    </div>
    
    <script>
        // Dynamic content loading
        const baseUrl = window.location.origin;
        
        // Update base URL in code examples
        document.querySelectorAll('.code-block').forEach(block => {
            block.innerHTML = block.innerHTML.replace(/{{ base_url }}/g, baseUrl);
        });
        
        // Check service health and update status
        fetch('/health')
            .then(response => response.json())
            .then(data => {
                const statusIndicator = document.getElementById('status');
                const statusText = document.getElementById('status-text');
                
                statusIndicator.className = 'status-indicator status-online';
                statusText.textContent = 'Service is online and ready';
                
                // Update model information
                document.getElementById('model-id').textContent = data.model_id || 'N/A';
                document.getElementById('device').textContent = data.device || 'N/A';
                document.getElementById('dimensions').textContent = data.dim || 'N/A';
                document.getElementById('batch-size').textContent = data.batch_size || 'N/A';
            })
            .catch(error => {
                console.error('Error fetching health data:', error);
                const statusIndicator = document.getElementById('status');
                const statusText = document.getElementById('status-text');
                
                statusIndicator.className = 'status-indicator';
                statusIndicator.style.background = '#dc3545';
                statusText.textContent = 'Service unavailable';
            });
    </script>
</body>
</html>